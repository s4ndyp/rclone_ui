version: '3.8'

services:
  rclone-web-gui-python:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "8080:8000"    # Web interface
      - "5572:5572"    # Rclone RC (forwarded from host)
    volumes:
      - rclone-data:/data  # Persistent rclone config
    environment:
      - RCLONE_RC_URL=http://host.docker.internal:5572
      - RCLONE_RC_USER=${RCLONE_RC_USER:-admin}
      - RCLONE_RC_PASS=${RCLONE_RC_PASS:-secret}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    depends_on:
      - rclone-rc

  rclone-rc:
    image: rclone/rclone:latest
    command: rcd --rc-addr=0.0.0.0:5572 --rc-user=admin --rc-pass=secret --rc-allow-origin="*"
    ports:
      - "5572:5572"
    volumes:
      - rclone-data:/data
      - ${HOME}/.config/rclone:/config:ro
    environment:
      - RCLONE_CONFIG=/data/rclone.conf
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5572/"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  rclone-data:
    driver: local
